{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "armsaType": {
      "type": "string",
      "defaultValue": "Standard_LRS",
      "allowedValues": [
        "Standard_LRS",
        "Standard_ZRS",
        "Standard_GRS",
        "Standard_RAGRS",
        "Premium_LRS"
      ]
    },
    "win01Name": {
      "type": "string",
      "minLength": 1
    },
    "win01AdminUserName": {
      "type": "string",
      "minLength": 1
    },
    "win01AdminPassword": {
      "type": "securestring"
    },
    "win01WindowsOSVersion": {
      "type": "string",
      "defaultValue": "2012-R2-Datacenter",
      "allowedValues": [
        "2008-R2-SP1",
        "2012-Datacenter",
        "2012-R2-Datacenter",
        "Windows-Server-Technical-Preview"
      ]
    },
    "win02Name": {
      "type": "string",
      "minLength": 1
    },
    "ubuntu01Name": {
      "type": "string",
      "minLength": 1
    },
    "ubuntu01AdminUserName": {
      "type": "string",
      "minLength": 1
    },
    "ubuntu01AdminPassword": {
      "type": "securestring"
    },
    "ubuntu01UbuntuOSVersion": {
      "type": "string",
      "defaultValue": "14.04.2-LTS",
      "allowedValues": [
        "12.04.5-LTS",
        "14.04.2-LTS"
      ]
    },
    "ubuntu02Name": {
      "type": "string",
      "minLength": 1
    },
    "win01Nic-pipDnsName": {
      "type": "string",
      "minLength": 1
    },
    "win02Nic-pipDnsName": {
      "type": "string",
      "minLength": 1
    },
    "ubuntu01Nic-pipDnsName": {
      "type": "string",
      "minLength": 1
    },
    "ubuntu02Nic-pipDnsName": {
      "type": "string",
      "minLength": 1
    },
    "workspaceId": {
      "type": "string",
      "metadata": {
        "description": "The Workspace ID is the Operations Management Suite Workspace ID found in the OMS Console under Settings and Connected Sources"
      }
    },
    "workspaceKey": {
      "type": "string",
      "metadata": {
        "description": "The Workspace Key is the Operations Management Suite Workspace Key found in the OMS Console under Settings and Connected Sources"
      }
    },
    "aswinName": {
      "type": "string",
      "minLength": 1
    },
    "asubuntuName": {
      "type": "string",
      "minLength": 1
    }
  },
  "variables": {
    "armsaName": "[concat('armsa', uniqueString(resourceGroup().id))]",
    "vnet01Prefix": "10.0.0.0/16",
    "vnet01Subnet1Name": "Subnet-1",
    "vnet01Subnet1Prefix": "10.0.0.0/24",
    "vnet01Subnet2Name": "Subnet-2",
    "vnet01Subnet2Prefix": "10.0.1.0/24",
    "win01ImagePublisher": "MicrosoftWindowsServer",
    "win01ImageOffer": "WindowsServer",
    "win01OSDiskName": "win01OSDisk",
    "win01VmSize": "Standard_D2_v2",
    "win01VnetID": "[resourceId('Microsoft.Network/virtualNetworks', 'vnet01')]",
    "win01SubnetRef": "[concat(variables('win01VnetID'), '/subnets/', variables('vnet01Subnet1Name'))]",
    "win01StorageAccountContainerName": "vhds",
    "win01NicName": "[concat(parameters('win01Name'), 'NetworkInterface')]",
    "win02ImagePublisher": "MicrosoftWindowsServer",
    "win02ImageOffer": "WindowsServer",
    "win02OSDiskName": "win02OSDisk",
    "win02VmSize": "Standard_D2_v2",
    "win02VnetID": "[resourceId('Microsoft.Network/virtualNetworks', 'vnet01')]",
    "win02SubnetRef": "[concat(variables('win02VnetID'), '/subnets/', variables('vnet01Subnet1Name'))]",
    "win02StorageAccountContainerName": "vhds",
    "win02NicName": "[concat(parameters('win02Name'), 'NetworkInterface')]",
    "ubuntu01ImagePublisher": "Canonical",
    "ubuntu01ImageOffer": "UbuntuServer",
    "ubuntu01OSDiskName": "ubuntu01OSDisk",
    "ubuntu01VmSize": "Standard_D2_v2",
    "ubuntu01VnetID": "[resourceId('Microsoft.Network/virtualNetworks', 'vnet01')]",
    "ubuntu01SubnetRef": "[concat(variables('ubuntu01VnetID'), '/subnets/', variables('vnet01Subnet2Name'))]",
    "ubuntu01StorageAccountContainerName": "vhds",
    "ubuntu01NicName": "[concat(parameters('ubuntu01Name'), 'NetworkInterface')]",
    "ubuntu02ImagePublisher": "Canonical",
    "ubuntu02ImageOffer": "UbuntuServer",
    "ubuntu02OSDiskName": "ubuntu02OSDisk",
    "ubuntu02VmSize": "Standard_D2_v2",
    "ubuntu02VnetID": "[resourceId('Microsoft.Network/virtualNetworks', 'vnet01')]",
    "ubuntu02SubnetRef": "[concat(variables('ubuntu02VnetID'), '/subnets/', variables('vnet01Subnet2Name'))]",
    "ubuntu02StorageAccountContainerName": "vhds",
    "ubuntu02NicName": "[concat(parameters('ubuntu02Name'), 'NetworkInterface')]",
    "win01Nic-pipName": "win01Nic-pip",
    "win02Nic-pipName": "win02Nic-pip",
    "ubuntu01Nic-pipName": "ubuntu01Nic-pip",
    "ubuntu02Nic-pipName": "ubuntu02Nic-pip",
    "diagnosticsStorageAccountName": "[variables('armsaName')]",
    "diagnosticsStorageAccountResourceGroup": "[resourceGroup().name]",
    "accountid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', variables('diagnosticsStorageAccountResourceGroup'), '/providers/', 'Microsoft.Storage/storageAccounts/', variables('diagnosticsStorageAccountName'))]",
    "wadmetricsresourceid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name , '/providers/', 'Microsoft.Compute/virtualMachines/')]",
    "diagnosticsStorageAccountName2": "[variables('armsaName')]",
    "diagnosticsStorageAccountResourceGroup2": "[resourceGroup().name]",
    "accountid2": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', variables('diagnosticsStorageAccountResourceGroup2'), '/providers/', 'Microsoft.Storage/storageAccounts/', variables('diagnosticsStorageAccountName2'))]",
    "wadmetricsresourceid2": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name , '/providers/', 'Microsoft.Compute/virtualMachines/')]",
    "diagnosticsStorageAccountName3": "[variables('armsaName')]",
    "ladMetricsResourceId": "[resourceId('Microsoft.Compute/virtualMachines', parameters('ubuntu01Name'))]",
    "diagnosticsStorageAccountName4": "[variables('armsaName')]",
    "ladMetricsResourceId2": "[resourceId('Microsoft.Compute/virtualMachines', parameters('ubuntu02Name'))]"
  },
  "resources": [
    {
      "name": "[variables('armsaName')]",
      "type": "Microsoft.Storage/storageAccounts",
      "location": "[resourceGroup().location]",
      "apiVersion": "2015-06-15",
      "dependsOn": [],
      "tags": {
        "displayName": "armsa"
      },
      "properties": {
        "accountType": "[parameters('armsaType')]"
      }
    },
    {
      "name": "vnet01",
      "type": "Microsoft.Network/virtualNetworks",
      "location": "[resourceGroup().location]",
      "apiVersion": "2015-06-15",
      "dependsOn": [],
      "tags": {
        "displayName": "vnet01"
      },
      "properties": {
        "addressSpace": {
          "addressPrefixes": [
            "[variables('vnet01Prefix')]"
          ]
        },
        "subnets": [
          {
            "name": "[variables('vnet01Subnet1Name')]",
            "properties": {
              "addressPrefix": "[variables('vnet01Subnet1Prefix')]"
            }
          },
          {
            "name": "[variables('vnet01Subnet2Name')]",
            "properties": {
              "addressPrefix": "[variables('vnet01Subnet2Prefix')]"
            }
          }
        ]
      }
    },
    {
      "name": "[variables('win01NicName')]",
      "type": "Microsoft.Network/networkInterfaces",
      "location": "[resourceGroup().location]",
      "apiVersion": "2015-06-15",
      "dependsOn": [
        "[resourceId('Microsoft.Network/virtualNetworks', 'vnet01')]",
        "[resourceId('Microsoft.Network/publicIPAddresses', variables('win01Nic-pipName'))]"
      ],
      "tags": {
        "displayName": "win01Nic"
      },
      "properties": {
        "ipConfigurations": [
          {
            "name": "ipconfig1",
            "properties": {
              "PrivateIpAddress": "10.0.0.4",
              "privateIPAllocationMethod": "Static",
              "subnet": {
                "id": "[variables('win01SubnetRef')]"
              },
              "publicIPAddress": {
                "id": "[resourceId('Microsoft.Network/publicIPAddresses', variables('win01Nic-pipName'))]"
              }
            }
          }
        ]
      }
    },
    {
      "name": "[parameters('win01Name')]",
      "type": "Microsoft.Compute/virtualMachines",
      "location": "[resourceGroup().location]",
      "apiVersion": "2015-06-15",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts', variables('armsaName'))]",
        "[resourceId('Microsoft.Network/networkInterfaces', variables('win01NicName'))]",
        "[resourceId('Microsoft.Compute/availabilitySets', parameters('aswinName'))]"
      ],
      "tags": {
        "displayName": "win01"
      },
      "properties": {
        "availabilitySet": {
          "id": "[resourceId('Microsoft.Compute/availabilitySets', parameters('aswinName'))]"
        },
        "hardwareProfile": {
          "vmSize": "[variables('win01VmSize')]"
        },
        "osProfile": {
          "computerName": "[parameters('win01Name')]",
          "adminUsername": "[parameters('win01AdminUsername')]",
          "adminPassword": "[parameters('win01AdminPassword')]"
        },
        "storageProfile": {
          "imageReference": {
            "publisher": "[variables('win01ImagePublisher')]",
            "offer": "[variables('win01ImageOffer')]",
            "sku": "[parameters('win01WindowsOSVersion')]",
            "version": "latest"
          },
          "osDisk": {
            "name": "win01OSDisk",
            "vhd": {
              "uri": "[concat('https://', variables('armsaName'), '.blob.core.windows.net/', variables('win01StorageAccountContainerName'), '/', variables('win01OSDiskName'), '.vhd')]"
            },
            "caching": "ReadWrite",
            "createOption": "FromImage"
          }
        },
        "networkProfile": {
          "networkInterfaces": [
            {
              "id": "[resourceId('Microsoft.Network/networkInterfaces', variables('win01NicName'))]"
            }
          ]
        }
      },
      "resources": [
        {
          "name": "Microsoft.Insights.VMDiagnosticsSettings",
          "type": "extensions",
          "location": "[resourceGroup().location]",
          "apiVersion": "2015-06-15",
          "dependsOn": [
            "[resourceId('Microsoft.Compute/virtualMachines', parameters('win01Name'))]"
          ],
          "tags": {
            "displayName": "win01diag"
          },
          "properties": {
            "publisher": "Microsoft.Azure.Diagnostics",
            "type": "IaaSDiagnostics",
            "typeHandlerVersion": "1.5",
            "autoUpgradeMinorVersion": true,
            "settings": {
              "WadCfg": {
                "DiagnosticMonitorConfiguration": {
                  "overallQuotaInMB": "4096",
                  "DiagnosticInfrastructureLogs": {
                    "scheduledTransferLogLevelFilter": "Error"
                  },
                  "WindowsEventLog": {
                    "scheduledTransferPeriod": "PT1M",
                    "DataSource": [
                      {
                        "name": "Application!*[System[(Level = 1) or (Level = 2)]]"
                      },
                      {
                        "name": "Security!*[System[(Level = 1 or Level = 2)]]"
                      },
                      {
                        "name": "System!*[System[(Level = 1 or Level = 2)]]"
                      }
                    ]
                  },
                  "PerformanceCounters": {
                    "scheduledTransferPeriod": "PT1M",
                    "PerformanceCounterConfiguration": [
                      {
                        "counterSpecifier": "\\Processor(_Total)\\% Processor Time",
                        "sampleRate": "PT15S",
                        "unit": "Percent",
                        "annotation": [
                          {
                            "displayName": "CPU utilization",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\Processor(_Total)\\% Privileged Time",
                        "sampleRate": "PT15S",
                        "unit": "Percent",
                        "annotation": [
                          {
                            "displayName": "CPU privileged time",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\Processor(_Total)\\% User Time",
                        "sampleRate": "PT15S",
                        "unit": "Percent",
                        "annotation": [
                          {
                            "displayName": "CPU user time",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\Processor Information(_Total)\\Processor Frequency",
                        "sampleRate": "PT15S",
                        "unit": "Count",
                        "annotation": [
                          {
                            "displayName": "CPU frequency",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\System\\Processes",
                        "sampleRate": "PT15S",
                        "unit": "Count",
                        "annotation": [
                          {
                            "displayName": "Processes",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\Process(_Total)\\Thread Count",
                        "sampleRate": "PT15S",
                        "unit": "Count",
                        "annotation": [
                          {
                            "displayName": "Threads",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\Process(_Total)\\Handle Count",
                        "sampleRate": "PT15S",
                        "unit": "Count",
                        "annotation": [
                          {
                            "displayName": "Handles",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\Memory\\% Committed Bytes In Use",
                        "sampleRate": "PT15S",
                        "unit": "Percent",
                        "annotation": [
                          {
                            "displayName": "Memory usage",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\Memory\\Available Bytes",
                        "sampleRate": "PT15S",
                        "unit": "Bytes",
                        "annotation": [
                          {
                            "displayName": "Memory available",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\Memory\\Committed Bytes",
                        "sampleRate": "PT15S",
                        "unit": "Bytes",
                        "annotation": [
                          {
                            "displayName": "Memory committed",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\Memory\\Commit Limit",
                        "sampleRate": "PT15S",
                        "unit": "Bytes",
                        "annotation": [
                          {
                            "displayName": "Memory commit limit",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\PhysicalDisk(_Total)\\% Disk Time",
                        "sampleRate": "PT15S",
                        "unit": "Percent",
                        "annotation": [
                          {
                            "displayName": "Disk active time",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\PhysicalDisk(_Total)\\% Disk Read Time",
                        "sampleRate": "PT15S",
                        "unit": "Percent",
                        "annotation": [
                          {
                            "displayName": "Disk active read time",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\PhysicalDisk(_Total)\\% Disk Write Time",
                        "sampleRate": "PT15S",
                        "unit": "Percent",
                        "annotation": [
                          {
                            "displayName": "Disk active write time",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\PhysicalDisk(_Total)\\Disk Transfers/sec",
                        "sampleRate": "PT15S",
                        "unit": "CountPerSecond",
                        "annotation": [
                          {
                            "displayName": "Disk operations",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\PhysicalDisk(_Total)\\Disk Reads/sec",
                        "sampleRate": "PT15S",
                        "unit": "CountPerSecond",
                        "annotation": [
                          {
                            "displayName": "Disk read operations",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\PhysicalDisk(_Total)\\Disk Writes/sec",
                        "sampleRate": "PT15S",
                        "unit": "CountPerSecond",
                        "annotation": [
                          {
                            "displayName": "Disk write operations",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\PhysicalDisk(_Total)\\Disk Bytes/sec",
                        "sampleRate": "PT15S",
                        "unit": "BytesPerSecond",
                        "annotation": [
                          {
                            "displayName": "Disk speed",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\PhysicalDisk(_Total)\\Disk Read Bytes/sec",
                        "sampleRate": "PT15S",
                        "unit": "BytesPerSecond",
                        "annotation": [
                          {
                            "displayName": "Disk read speed",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\PhysicalDisk(_Total)\\Disk Write Bytes/sec",
                        "sampleRate": "PT15S",
                        "unit": "BytesPerSecond",
                        "annotation": [
                          {
                            "displayName": "Disk write speed",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\LogicalDisk(_Total)\\% Free Space",
                        "sampleRate": "PT15S",
                        "unit": "Percent",
                        "annotation": [
                          {
                            "displayName": "Disk free space (percentage)",
                            "locale": "en-us"
                          }
                        ]
                      }
                    ]
                  },
                  "Metrics": {
                    "resourceId": "[concat(variables('wadmetricsresourceid'), parameters('win01Name'))]",
                    "MetricAggregation": [
                      {
                        "scheduledTransferPeriod": "PT1H"
                      },
                      {
                        "scheduledTransferPeriod": "PT1M"
                      }
                    ]
                  }
                }
              },
              "storageAccount": "[variables('diagnosticsStorageAccountName')]"
            },
            "protectedSettings": {
              "storageAccountName": "[variables('diagnosticsStorageAccountName')]",
              "storageAccountKey": "[listkeys(variables('accountid'), '2015-06-15').key1]",
              "storageAccountEndPoint": "https://core.windows.net"
            }
          }
        },
        {
          "name": "Microsoft.EnterpriseCloud.Monitoring",
          "type": "extensions",
          "location": "[resourceGroup().location]",
          "apiVersion": "2015-06-15",
          "dependsOn": [
            "[resourceId('Microsoft.Compute/virtualMachines', parameters('win01Name'))]"
          ],
          "tags": {
            "displayName": "omsAgent"
          },
          "properties": {
            "publisher": "Microsoft.EnterpriseCloud.Monitoring",
            "type": "MicrosoftMonitoringAgent",
            "typeHandlerVersion": "1.0",
            "autoUpgradeMinorVersion": true,
            "settings": {
              "workspaceId": "[parameters('workspaceId')]"
            },
            "protectedSettings": {
              "workspaceKey": "[parameters('workspaceKey')]"
            }
          }
        },
        {
          "type": "extensions",
          "name": "Microsoft.Antimalware",
          "apiVersion": "2016-03-30",
          "location": "[resourceGroup().location]",
          "dependsOn": [
            "[concat('Microsoft.Compute/virtualMachines/', parameters('win01Name'))]"
          ],
          "properties": {
            "publisher": "Microsoft.Azure.Security",
            "autoUpgradeMinorVersion": true,
            "type": "IaaSAntimalware",
            "typeHandlerVersion": "1.3",
            "settings": {
              "AntimalwareEnabled": true,
              "Exclusions": {
                "Paths": "",
                "Extensions": "",
                "Processes": ""
              },
              "RealtimeProtectionEnabled": "true",
              "ScheduledScanSettings": {
                "isEnabled": "false",
                "scanType": "Quick",
                "day": "7",
                "time": "120"
              }
            },
            "protectedSettings": null
          }
        }
      ]
    },
    {
      "name": "[variables('win02NicName')]",
      "type": "Microsoft.Network/networkInterfaces",
      "location": "[resourceGroup().location]",
      "apiVersion": "2015-06-15",
      "dependsOn": [
        "[resourceId('Microsoft.Network/virtualNetworks', 'vnet01')]",
        "[resourceId('Microsoft.Network/publicIPAddresses', variables('win02Nic-pipName'))]"
      ],
      "tags": {
        "displayName": "win02Nic"
      },
      "properties": {
        "ipConfigurations": [
          {
            "name": "ipconfig1",
            "properties": {
              "PrivateIpAddress": "10.0.0.5",
              "privateIPAllocationMethod": "Static",
              "subnet": {
                "id": "[variables('win02SubnetRef')]"
              },
              "publicIPAddress": {
                "id": "[resourceId('Microsoft.Network/publicIPAddresses', variables('win02Nic-pipName'))]"
              }
            }
          }
        ]
      }
    },
    {
      "name": "[parameters('win02Name')]",
      "type": "Microsoft.Compute/virtualMachines",
      "location": "[resourceGroup().location]",
      "apiVersion": "2015-06-15",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts', variables('armsaName'))]",
        "[resourceId('Microsoft.Network/networkInterfaces', variables('win02NicName'))]",
        "[resourceId('Microsoft.Compute/availabilitySets', parameters('aswinName'))]"
      ],
      "tags": {
        "displayName": "win02"
      },
      "properties": {
        "availabilitySet": {
          "id": "[resourceId('Microsoft.Compute/availabilitySets', parameters('aswinName'))]"
        },
        "hardwareProfile": {
          "vmSize": "[variables('win02VmSize')]"
        },
        "osProfile": {
          "computerName": "[parameters('win02Name')]",
          "adminUsername": "[parameters('win01AdminUsername')]",
          "adminPassword": "[parameters('win01AdminPassword')]"
        },
        "storageProfile": {
          "imageReference": {
            "publisher": "[variables('win02ImagePublisher')]",
            "offer": "[variables('win02ImageOffer')]",
            "sku": "[parameters('win01WindowsOSVersion')]",
            "version": "latest"
          },
          "osDisk": {
            "name": "win02OSDisk",
            "vhd": {
              "uri": "[concat('https://', variables('armsaName'), '.blob.core.windows.net/', variables('win02StorageAccountContainerName'), '/', variables('win02OSDiskName'), '.vhd')]"
            },
            "caching": "ReadWrite",
            "createOption": "FromImage"
          }
        },
        "networkProfile": {
          "networkInterfaces": [
            {
              "id": "[resourceId('Microsoft.Network/networkInterfaces', variables('win02NicName'))]"
            }
          ]
        }
      },
      "resources": [
        {
          "name": "Microsoft.Insights.VMDiagnosticsSettings",
          "type": "extensions",
          "location": "[resourceGroup().location]",
          "apiVersion": "2015-06-15",
          "dependsOn": [
            "[resourceId('Microsoft.Compute/virtualMachines', parameters('win02Name'))]"
          ],
          "tags": {
            "displayName": "win02diag"
          },
          "properties": {
            "publisher": "Microsoft.Azure.Diagnostics",
            "type": "IaaSDiagnostics",
            "typeHandlerVersion": "1.5",
            "autoUpgradeMinorVersion": true,
            "settings": {
              "WadCfg": {
                "DiagnosticMonitorConfiguration": {
                  "overallQuotaInMB": "4096",
                  "DiagnosticInfrastructureLogs": {
                    "scheduledTransferLogLevelFilter": "Error"
                  },
                  "WindowsEventLog": {
                    "scheduledTransferPeriod": "PT1M",
                    "DataSource": [
                      {
                        "name": "Application!*[System[(Level = 1) or (Level = 2)]]"
                      },
                      {
                        "name": "Security!*[System[(Level = 1 or Level = 2)]]"
                      },
                      {
                        "name": "System!*[System[(Level = 1 or Level = 2)]]"
                      }
                    ]
                  },
                  "PerformanceCounters": {
                    "scheduledTransferPeriod": "PT1M",
                    "PerformanceCounterConfiguration": [
                      {
                        "counterSpecifier": "\\Processor(_Total)\\% Processor Time",
                        "sampleRate": "PT15S",
                        "unit": "Percent",
                        "annotation": [
                          {
                            "displayName": "CPU utilization",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\Processor(_Total)\\% Privileged Time",
                        "sampleRate": "PT15S",
                        "unit": "Percent",
                        "annotation": [
                          {
                            "displayName": "CPU privileged time",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\Processor(_Total)\\% User Time",
                        "sampleRate": "PT15S",
                        "unit": "Percent",
                        "annotation": [
                          {
                            "displayName": "CPU user time",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\Processor Information(_Total)\\Processor Frequency",
                        "sampleRate": "PT15S",
                        "unit": "Count",
                        "annotation": [
                          {
                            "displayName": "CPU frequency",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\System\\Processes",
                        "sampleRate": "PT15S",
                        "unit": "Count",
                        "annotation": [
                          {
                            "displayName": "Processes",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\Process(_Total)\\Thread Count",
                        "sampleRate": "PT15S",
                        "unit": "Count",
                        "annotation": [
                          {
                            "displayName": "Threads",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\Process(_Total)\\Handle Count",
                        "sampleRate": "PT15S",
                        "unit": "Count",
                        "annotation": [
                          {
                            "displayName": "Handles",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\Memory\\% Committed Bytes In Use",
                        "sampleRate": "PT15S",
                        "unit": "Percent",
                        "annotation": [
                          {
                            "displayName": "Memory usage",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\Memory\\Available Bytes",
                        "sampleRate": "PT15S",
                        "unit": "Bytes",
                        "annotation": [
                          {
                            "displayName": "Memory available",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\Memory\\Committed Bytes",
                        "sampleRate": "PT15S",
                        "unit": "Bytes",
                        "annotation": [
                          {
                            "displayName": "Memory committed",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\Memory\\Commit Limit",
                        "sampleRate": "PT15S",
                        "unit": "Bytes",
                        "annotation": [
                          {
                            "displayName": "Memory commit limit",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\PhysicalDisk(_Total)\\% Disk Time",
                        "sampleRate": "PT15S",
                        "unit": "Percent",
                        "annotation": [
                          {
                            "displayName": "Disk active time",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\PhysicalDisk(_Total)\\% Disk Read Time",
                        "sampleRate": "PT15S",
                        "unit": "Percent",
                        "annotation": [
                          {
                            "displayName": "Disk active read time",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\PhysicalDisk(_Total)\\% Disk Write Time",
                        "sampleRate": "PT15S",
                        "unit": "Percent",
                        "annotation": [
                          {
                            "displayName": "Disk active write time",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\PhysicalDisk(_Total)\\Disk Transfers/sec",
                        "sampleRate": "PT15S",
                        "unit": "CountPerSecond",
                        "annotation": [
                          {
                            "displayName": "Disk operations",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\PhysicalDisk(_Total)\\Disk Reads/sec",
                        "sampleRate": "PT15S",
                        "unit": "CountPerSecond",
                        "annotation": [
                          {
                            "displayName": "Disk read operations",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\PhysicalDisk(_Total)\\Disk Writes/sec",
                        "sampleRate": "PT15S",
                        "unit": "CountPerSecond",
                        "annotation": [
                          {
                            "displayName": "Disk write operations",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\PhysicalDisk(_Total)\\Disk Bytes/sec",
                        "sampleRate": "PT15S",
                        "unit": "BytesPerSecond",
                        "annotation": [
                          {
                            "displayName": "Disk speed",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\PhysicalDisk(_Total)\\Disk Read Bytes/sec",
                        "sampleRate": "PT15S",
                        "unit": "BytesPerSecond",
                        "annotation": [
                          {
                            "displayName": "Disk read speed",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\PhysicalDisk(_Total)\\Disk Write Bytes/sec",
                        "sampleRate": "PT15S",
                        "unit": "BytesPerSecond",
                        "annotation": [
                          {
                            "displayName": "Disk write speed",
                            "locale": "en-us"
                          }
                        ]
                      },
                      {
                        "counterSpecifier": "\\LogicalDisk(_Total)\\% Free Space",
                        "sampleRate": "PT15S",
                        "unit": "Percent",
                        "annotation": [
                          {
                            "displayName": "Disk free space (percentage)",
                            "locale": "en-us"
                          }
                        ]
                      }
                    ]
                  },
                  "Metrics": {
                    "resourceId": "[concat(variables('wadmetricsresourceid2'), parameters('win02Name'))]",
                    "MetricAggregation": [
                      {
                        "scheduledTransferPeriod": "PT1H"
                      },
                      {
                        "scheduledTransferPeriod": "PT1M"
                      }
                    ]
                  }
                }
              },
              "storageAccount": "[variables('diagnosticsStorageAccountName2')]"
            },
            "protectedSettings": {
              "storageAccountName": "[variables('diagnosticsStorageAccountName2')]",
              "storageAccountKey": "[listkeys(variables('accountid2'), '2015-06-15').key1]",
              "storageAccountEndPoint": "https://core.windows.net"
            }
          }
        },
        {
          "name": "Microsoft.EnterpriseCloud.Monitoring",
          "type": "extensions",
          "location": "[resourceGroup().location]",
          "apiVersion": "2015-06-15",
          "dependsOn": [
            "[resourceId('Microsoft.Compute/virtualMachines', parameters('win02Name'))]"
          ],
          "tags": {
            "displayName": "omsAgent"
          },
          "properties": {
            "publisher": "Microsoft.EnterpriseCloud.Monitoring",
            "type": "MicrosoftMonitoringAgent",
            "typeHandlerVersion": "1.0",
            "autoUpgradeMinorVersion": true,
            "settings": {
              "workspaceId": "[parameters('workspaceId')]"
            },
            "protectedSettings": {
              "workspaceKey": "[parameters('workspaceKey')]"
            }
          }
        },
        {
          "type": "extensions",
          "name": "Microsoft.Antimalware",
          "apiVersion": "2016-03-30",
          "location": "[resourceGroup().location]",
          "dependsOn": [
            "[concat('Microsoft.Compute/virtualMachines/', parameters('win02Name'))]"
          ],
          "properties": {
            "publisher": "Microsoft.Azure.Security",
            "autoUpgradeMinorVersion": true,
            "type": "IaaSAntimalware",
            "typeHandlerVersion": "1.3",
            "settings": {
              "AntimalwareEnabled": true,
              "Exclusions": {
                "Paths": "",
                "Extensions": "",
                "Processes": ""
              },
              "RealtimeProtectionEnabled": "true",
              "ScheduledScanSettings": {
                "isEnabled": "false",
                "scanType": "Quick",
                "day": "7",
                "time": "120"
              }
            },
            "protectedSettings": null
          }
        }
      ]
    },
    {
      "name": "[variables('ubuntu01NicName')]",
      "type": "Microsoft.Network/networkInterfaces",
      "location": "[resourceGroup().location]",
      "apiVersion": "2015-06-15",
      "dependsOn": [
        "[resourceId('Microsoft.Network/virtualNetworks', 'vnet01')]",
        "[resourceId('Microsoft.Network/publicIPAddresses', variables('ubuntu01Nic-pipName'))]"
      ],
      "tags": {
        "displayName": "ubuntu01Nic"
      },
      "properties": {
        "ipConfigurations": [
          {
            "name": "ipconfig1",
            "properties": {
              "PrivateIpAddress": "10.0.1.4",
              "privateIPAllocationMethod": "Static",
              "subnet": {
                "id": "[variables('ubuntu01SubnetRef')]"
              },
              "publicIPAddress": {
                "id": "[resourceId('Microsoft.Network/publicIPAddresses', variables('ubuntu01Nic-pipName'))]"
              }
            }
          }
        ]
      }
    },
    {
      "name": "[parameters('ubuntu01Name')]",
      "type": "Microsoft.Compute/virtualMachines",
      "location": "[resourceGroup().location]",
      "apiVersion": "2015-06-15",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts', variables('armsaName'))]",
        "[resourceId('Microsoft.Network/networkInterfaces', variables('ubuntu01NicName'))]",
        "[resourceId('Microsoft.Compute/availabilitySets', parameters('asubuntuName'))]"
      ],
      "tags": {
        "displayName": "ubuntu01"
      },
      "properties": {
        "availabilitySet": {
          "id": "[resourceId('Microsoft.Compute/availabilitySets', parameters('asubuntuName'))]"
        },
        "hardwareProfile": {
          "vmSize": "[variables('ubuntu01VmSize')]"
        },
        "osProfile": {
          "computerName": "[parameters('ubuntu01Name')]",
          "adminUsername": "[parameters('ubuntu01AdminUsername')]",
          "adminPassword": "[parameters('ubuntu01AdminPassword')]"
        },
        "storageProfile": {
          "imageReference": {
            "publisher": "[variables('ubuntu01ImagePublisher')]",
            "offer": "[variables('ubuntu01ImageOffer')]",
            "sku": "[parameters('ubuntu01UbuntuOSVersion')]",
            "version": "latest"
          },
          "osDisk": {
            "name": "ubuntu01OSDisk",
            "vhd": {
              "uri": "[concat('https://', variables('armsaName'), '.blob.core.windows.net/', variables('ubuntu01StorageAccountContainerName'), '/', variables('ubuntu01OSDiskName'), '.vhd')]"
            },
            "caching": "ReadWrite",
            "createOption": "FromImage"
          }
        },
        "networkProfile": {
          "networkInterfaces": [
            {
              "id": "[resourceId('Microsoft.Network/networkInterfaces', variables('ubuntu01NicName'))]"
            }
          ]
        }
      },
      "resources": [
        {
          "name": "Microsoft.Insights.VMDiagnosticsSettings",
          "type": "extensions",
          "location": "[resourceGroup().location]",
          "apiVersion": "2015-06-15",
          "dependsOn": [
            "[resourceId('Microsoft.Compute/virtualMachines', parameters('ubuntu01Name'))]"
          ],
          "tags": {
            "displayName": "ubuntu01diag"
          },
          "properties": {
            "publisher": "Microsoft.OSTCExtensions",
            "type": "LinuxDiagnostic",
            "typeHandlerVersion": "2.3",
            "autoUpgradeMinorVersion": true,
            "settings": {
              "ladCfg": {
                "diagnosticMonitorConfiguration": {
                  "performanceCounters": {
                    "performanceCounterConfiguration": [
                      {
                        "namespace": "root/scx",
                        "class": "Memory",
                        "counterSpecifier": "AvailableMemory",
                        "table": "LinuxMemory"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Memory",
                        "counterSpecifier": "PercentAvailableMemory",
                        "table": "LinuxMemory"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Memory",
                        "counterSpecifier": "UsedMemory",
                        "table": "LinuxMemory"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Memory",
                        "counterSpecifier": "PercentUsedMemory",
                        "table": "LinuxMemory"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Memory",
                        "counterSpecifier": "PercentUsedByCache",
                        "table": "LinuxMemory"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Memory",
                        "counterSpecifier": "PagesPerSec",
                        "table": "LinuxMemory"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Memory",
                        "counterSpecifier": "PagesReadPerSec",
                        "table": "LinuxMemory"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Memory",
                        "counterSpecifier": "PagesWrittenPerSec",
                        "table": "LinuxMemory"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Memory",
                        "counterSpecifier": "AvailableSwap",
                        "table": "LinuxMemory"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Memory",
                        "counterSpecifier": "PercentAvailableSwap",
                        "table": "LinuxMemory"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Memory",
                        "counterSpecifier": "UsedSwap",
                        "table": "LinuxMemory"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Memory",
                        "counterSpecifier": "PercentUsedSwap",
                        "table": "LinuxMemory"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Processor",
                        "counterSpecifier": "PercentIdleTime",
                        "table": "LinuxProcessor"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Processor",
                        "counterSpecifier": "PercentUserTime",
                        "table": "LinuxProcessor"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Processor",
                        "counterSpecifier": "PercentNiceTime",
                        "table": "LinuxProcessor"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Processor",
                        "counterSpecifier": "PercentPrivilegedTime",
                        "table": "LinuxProcessor"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Processor",
                        "counterSpecifier": "PercentInterruptTime",
                        "table": "LinuxProcessor"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Processor",
                        "counterSpecifier": "PercentDPCTime",
                        "table": "LinuxProcessor"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Processor",
                        "counterSpecifier": "PercentProcessorTime",
                        "table": "LinuxProcessor"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Processor",
                        "counterSpecifier": "PercentIOWaitTime",
                        "table": "LinuxProcessor"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "PhysicalDisk",
                        "counterSpecifier": "BytesPerSecond",
                        "table": "LinuxPhysicalDisk"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "PhysicalDisk",
                        "counterSpecifier": "ReadBytesPerSecond",
                        "table": "LinuxPhysicalDisk"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "PhysicalDisk",
                        "counterSpecifier": "WriteBytesPerSecond",
                        "table": "LinuxPhysicalDisk"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "PhysicalDisk",
                        "counterSpecifier": "TransfersPerSecond",
                        "table": "LinuxPhysicalDisk"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "PhysicalDisk",
                        "counterSpecifier": "ReadsPerSecond",
                        "table": "LinuxPhysicalDisk"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "PhysicalDisk",
                        "counterSpecifier": "WritesPerSecond",
                        "table": "LinuxPhysicalDisk"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "PhysicalDisk",
                        "counterSpecifier": "AverageReadTime",
                        "table": "LinuxPhysicalDisk"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "PhysicalDisk",
                        "counterSpecifier": "AverageWriteTime",
                        "table": "LinuxPhysicalDisk"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "PhysicalDisk",
                        "counterSpecifier": "AverageTransferTime",
                        "table": "LinuxPhysicalDisk"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "PhysicalDisk",
                        "counterSpecifier": "AverageDiskQueueLength",
                        "table": "LinuxPhysicalDisk"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "NetworkInterface",
                        "counterSpecifier": "BytesTransmitted",
                        "table": "LinuxNetworkInterface"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "NetworkInterface",
                        "counterSpecifier": "BytesReceived",
                        "table": "LinuxNetworkInterface"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "NetworkInterface",
                        "counterSpecifier": "PacketsTransmitted",
                        "table": "LinuxNetworkInterface"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "NetworkInterface",
                        "counterSpecifier": "PacketsReceived",
                        "table": "LinuxNetworkInterface"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "NetworkInterface",
                        "counterSpecifier": "BytesTotal",
                        "table": "LinuxNetworkInterface"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "NetworkInterface",
                        "counterSpecifier": "TotalRxErrors",
                        "table": "LinuxNetworkInterface"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "NetworkInterface",
                        "counterSpecifier": "TotalTxErrors",
                        "table": "LinuxNetworkInterface"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "NetworkInterface",
                        "counterSpecifier": "TotalCollisions",
                        "table": "LinuxNetworkInterface"
                      }
                    ]
                  },
                  "metrics": {
                    "resourceId": "[variables('ladMetricsResourceId')]",
                    "metricAggregation": [
                      {
                        "scheduledTransferPeriod": "PT1H"
                      },
                      {
                        "scheduledTransferPeriod": "PT1M"
                      }
                    ]
                  }
                }
              },
              "storageAccount": "[variables('diagnosticsStorageAccountName3')]"
            },
            "protectedSettings": {
              "storageAccountName": "[variables('diagnosticsStorageAccountName3')]",
              "storageAccountKey": "[listkeys(resourceId('Microsoft.Storage/storageAccounts', variables('diagnosticsStorageAccountName3')), '2015-06-15').key1]",
              "storageAccountEndPoint": "https://core.windows.net"
            }
          }
        },
        {
          "name": "Microsoft.EnterpriseCloud.Monitoring",
          "type": "extensions",
          "location": "[resourceGroup().location]",
          "apiVersion": "2015-06-15",
          "dependsOn": [
            "[resourceId('Microsoft.Compute/virtualMachines', parameters('ubuntu01Name'))]"
          ],
          "tags": {
            "displayName": "omsAgent"
          },
          "properties": {
            "publisher": "Microsoft.EnterpriseCloud.Monitoring",
            "type": "OmsAgentForLinux",
            "typeHandlerVersion": "1.0",
            "autoUpgradeMinorVersion": true,
            "settings": {
              "workspaceId": "[parameters('workspaceId')]"
            },
            "protectedSettings": {
              "workspaceKey": "[parameters('workspaceKey')]"
            }
          }
        }
      ]
    },
    {
      "name": "[variables('ubuntu02NicName')]",
      "type": "Microsoft.Network/networkInterfaces",
      "location": "[resourceGroup().location]",
      "apiVersion": "2015-06-15",
      "dependsOn": [
        "[resourceId('Microsoft.Network/virtualNetworks', 'vnet01')]",
        "[resourceId('Microsoft.Network/publicIPAddresses', variables('ubuntu02Nic-pipName'))]"
      ],
      "tags": {
        "displayName": "ubuntu02Nic"
      },
      "properties": {
        "ipConfigurations": [
          {
            "name": "ipconfig1",
            "properties": {
              "PrivateIpAddress": "10.0.1.5",
              "privateIPAllocationMethod": "Static",
              "subnet": {
                "id": "[variables('ubuntu02SubnetRef')]"
              },
              "publicIPAddress": {
                "id": "[resourceId('Microsoft.Network/publicIPAddresses', variables('ubuntu02Nic-pipName'))]"
              }
            }
          }
        ]
      }
    },
    {
      "name": "[parameters('ubuntu02Name')]",
      "type": "Microsoft.Compute/virtualMachines",
      "location": "[resourceGroup().location]",
      "apiVersion": "2015-06-15",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts', variables('armsaName'))]",
        "[resourceId('Microsoft.Network/networkInterfaces', variables('ubuntu02NicName'))]",
        "[resourceId('Microsoft.Compute/availabilitySets', parameters('asubuntuName'))]"
      ],
      "tags": {
        "displayName": "ubuntu02"
      },
      "properties": {
        "availabilitySet": {
          "id": "[resourceId('Microsoft.Compute/availabilitySets', parameters('asubuntuName'))]"
        },
        "hardwareProfile": {
          "vmSize": "[variables('ubuntu02VmSize')]"
        },
        "osProfile": {
          "computerName": "[parameters('ubuntu02Name')]",
          "adminUsername": "[parameters('ubuntu01AdminUsername')]",
          "adminPassword": "[parameters('ubuntu01AdminPassword')]"
        },
        "storageProfile": {
          "imageReference": {
            "publisher": "[variables('ubuntu02ImagePublisher')]",
            "offer": "[variables('ubuntu02ImageOffer')]",
            "sku": "[parameters('ubuntu01UbuntuOSVersion')]",
            "version": "latest"
          },
          "osDisk": {
            "name": "ubuntu02OSDisk",
            "vhd": {
              "uri": "[concat('https://', variables('armsaName'), '.blob.core.windows.net/', variables('ubuntu02StorageAccountContainerName'), '/', variables('ubuntu02OSDiskName'), '.vhd')]"
            },
            "caching": "ReadWrite",
            "createOption": "FromImage"
          }
        },
        "networkProfile": {
          "networkInterfaces": [
            {
              "id": "[resourceId('Microsoft.Network/networkInterfaces', variables('ubuntu02NicName'))]"
            }
          ]
        }
      },
      "resources": [
        {
          "name": "Microsoft.Insights.VMDiagnosticsSettings",
          "type": "extensions",
          "location": "[resourceGroup().location]",
          "apiVersion": "2015-06-15",
          "dependsOn": [
            "[resourceId('Microsoft.Compute/virtualMachines', parameters('ubuntu02Name'))]"
          ],
          "tags": {
            "displayName": "ubuntu02diag"
          },
          "properties": {
            "publisher": "Microsoft.OSTCExtensions",
            "type": "LinuxDiagnostic",
            "typeHandlerVersion": "2.3",
            "autoUpgradeMinorVersion": true,
            "settings": {
              "ladCfg": {
                "diagnosticMonitorConfiguration": {
                  "performanceCounters": {
                    "performanceCounterConfiguration": [
                      {
                        "namespace": "root/scx",
                        "class": "Memory",
                        "counterSpecifier": "AvailableMemory",
                        "table": "LinuxMemory"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Memory",
                        "counterSpecifier": "PercentAvailableMemory",
                        "table": "LinuxMemory"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Memory",
                        "counterSpecifier": "UsedMemory",
                        "table": "LinuxMemory"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Memory",
                        "counterSpecifier": "PercentUsedMemory",
                        "table": "LinuxMemory"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Memory",
                        "counterSpecifier": "PercentUsedByCache",
                        "table": "LinuxMemory"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Memory",
                        "counterSpecifier": "PagesPerSec",
                        "table": "LinuxMemory"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Memory",
                        "counterSpecifier": "PagesReadPerSec",
                        "table": "LinuxMemory"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Memory",
                        "counterSpecifier": "PagesWrittenPerSec",
                        "table": "LinuxMemory"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Memory",
                        "counterSpecifier": "AvailableSwap",
                        "table": "LinuxMemory"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Memory",
                        "counterSpecifier": "PercentAvailableSwap",
                        "table": "LinuxMemory"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Memory",
                        "counterSpecifier": "UsedSwap",
                        "table": "LinuxMemory"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Memory",
                        "counterSpecifier": "PercentUsedSwap",
                        "table": "LinuxMemory"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Processor",
                        "counterSpecifier": "PercentIdleTime",
                        "table": "LinuxProcessor"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Processor",
                        "counterSpecifier": "PercentUserTime",
                        "table": "LinuxProcessor"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Processor",
                        "counterSpecifier": "PercentNiceTime",
                        "table": "LinuxProcessor"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Processor",
                        "counterSpecifier": "PercentPrivilegedTime",
                        "table": "LinuxProcessor"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Processor",
                        "counterSpecifier": "PercentInterruptTime",
                        "table": "LinuxProcessor"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Processor",
                        "counterSpecifier": "PercentDPCTime",
                        "table": "LinuxProcessor"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Processor",
                        "counterSpecifier": "PercentProcessorTime",
                        "table": "LinuxProcessor"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "Processor",
                        "counterSpecifier": "PercentIOWaitTime",
                        "table": "LinuxProcessor"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "PhysicalDisk",
                        "counterSpecifier": "BytesPerSecond",
                        "table": "LinuxPhysicalDisk"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "PhysicalDisk",
                        "counterSpecifier": "ReadBytesPerSecond",
                        "table": "LinuxPhysicalDisk"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "PhysicalDisk",
                        "counterSpecifier": "WriteBytesPerSecond",
                        "table": "LinuxPhysicalDisk"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "PhysicalDisk",
                        "counterSpecifier": "TransfersPerSecond",
                        "table": "LinuxPhysicalDisk"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "PhysicalDisk",
                        "counterSpecifier": "ReadsPerSecond",
                        "table": "LinuxPhysicalDisk"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "PhysicalDisk",
                        "counterSpecifier": "WritesPerSecond",
                        "table": "LinuxPhysicalDisk"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "PhysicalDisk",
                        "counterSpecifier": "AverageReadTime",
                        "table": "LinuxPhysicalDisk"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "PhysicalDisk",
                        "counterSpecifier": "AverageWriteTime",
                        "table": "LinuxPhysicalDisk"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "PhysicalDisk",
                        "counterSpecifier": "AverageTransferTime",
                        "table": "LinuxPhysicalDisk"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "PhysicalDisk",
                        "counterSpecifier": "AverageDiskQueueLength",
                        "table": "LinuxPhysicalDisk"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "NetworkInterface",
                        "counterSpecifier": "BytesTransmitted",
                        "table": "LinuxNetworkInterface"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "NetworkInterface",
                        "counterSpecifier": "BytesReceived",
                        "table": "LinuxNetworkInterface"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "NetworkInterface",
                        "counterSpecifier": "PacketsTransmitted",
                        "table": "LinuxNetworkInterface"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "NetworkInterface",
                        "counterSpecifier": "PacketsReceived",
                        "table": "LinuxNetworkInterface"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "NetworkInterface",
                        "counterSpecifier": "BytesTotal",
                        "table": "LinuxNetworkInterface"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "NetworkInterface",
                        "counterSpecifier": "TotalRxErrors",
                        "table": "LinuxNetworkInterface"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "NetworkInterface",
                        "counterSpecifier": "TotalTxErrors",
                        "table": "LinuxNetworkInterface"
                      },
                      {
                        "namespace": "root/scx",
                        "class": "NetworkInterface",
                        "counterSpecifier": "TotalCollisions",
                        "table": "LinuxNetworkInterface"
                      }
                    ]
                  },
                  "metrics": {
                    "resourceId": "[variables('ladMetricsResourceId2')]",
                    "metricAggregation": [
                      {
                        "scheduledTransferPeriod": "PT1H"
                      },
                      {
                        "scheduledTransferPeriod": "PT1M"
                      }
                    ]
                  }
                }
              },
              "storageAccount": "[variables('diagnosticsStorageAccountName4')]"
            },
            "protectedSettings": {
              "storageAccountName": "[variables('diagnosticsStorageAccountName4')]",
              "storageAccountKey": "[listkeys(resourceId('Microsoft.Storage/storageAccounts', variables('diagnosticsStorageAccountName4')), '2015-06-15').key1]",
              "storageAccountEndPoint": "https://core.windows.net"
            }
          }
        },
        {
          "name": "Microsoft.EnterpriseCloud.Monitoring",
          "type": "extensions",
          "location": "[resourceGroup().location]",
          "apiVersion": "2015-06-15",
          "dependsOn": [
            "[resourceId('Microsoft.Compute/virtualMachines', parameters('ubuntu02Name'))]"
          ],
          "tags": {
            "displayName": "omsAgent"
          },
          "properties": {
            "publisher": "Microsoft.EnterpriseCloud.Monitoring",
            "type": "OmsAgentForLinux",
            "typeHandlerVersion": "1.0",
            "autoUpgradeMinorVersion": true,
            "settings": {
              "workspaceId": "[parameters('workspaceId')]"
            },
            "protectedSettings": {
              "workspaceKey": "[parameters('workspaceKey')]"
            }
          }
        }
      ]
    },
    {
      "name": "[variables('win01Nic-pipName')]",
      "type": "Microsoft.Network/publicIPAddresses",
      "location": "[resourceGroup().location]",
      "apiVersion": "2015-06-15",
      "dependsOn": [],
      "tags": {
        "displayName": "win01Nic-pip"
      },
      "properties": {
        "publicIPAllocationMethod": "Dynamic",
        "dnsSettings": {
          "domainNameLabel": "[parameters('win01Nic-pipDnsName')]"
        }
      }
    },
    {
      "name": "[variables('win02Nic-pipName')]",
      "type": "Microsoft.Network/publicIPAddresses",
      "location": "[resourceGroup().location]",
      "apiVersion": "2015-06-15",
      "dependsOn": [],
      "tags": {
        "displayName": "win02Nic-pip"
      },
      "properties": {
        "publicIPAllocationMethod": "Dynamic",
        "dnsSettings": {
          "domainNameLabel": "[parameters('win02Nic-pipDnsName')]"
        }
      }
    },
    {
      "name": "[variables('ubuntu01Nic-pipName')]",
      "type": "Microsoft.Network/publicIPAddresses",
      "location": "[resourceGroup().location]",
      "apiVersion": "2015-06-15",
      "dependsOn": [],
      "tags": {
        "displayName": "ubuntu01Nic-pip"
      },
      "properties": {
        "publicIPAllocationMethod": "Dynamic",
        "dnsSettings": {
          "domainNameLabel": "[parameters('ubuntu01Nic-pipDnsName')]"
        }
      }
    },
    {
      "name": "[variables('ubuntu02Nic-pipName')]",
      "type": "Microsoft.Network/publicIPAddresses",
      "location": "[resourceGroup().location]",
      "apiVersion": "2015-06-15",
      "dependsOn": [],
      "tags": {
        "displayName": "ubuntu02Nic-pip"
      },
      "properties": {
        "publicIPAllocationMethod": "Dynamic",
        "dnsSettings": {
          "domainNameLabel": "[parameters('ubuntu02Nic-pipDnsName')]"
        }
      }
    },
    {
      "name": "[parameters('aswinName')]",
      "type": "Microsoft.Compute/availabilitySets",
      "location": "[resourceGroup().location]",
      "apiVersion": "2015-06-15",
      "dependsOn": [],
      "tags": {
        "displayName": "aswin"
      },
      "properties": {
        "platformUpdateDomainCount": 3,
        "platformFaultDomainCount": 3
      }
    },
    {
      "name": "[parameters('asubuntuName')]",
      "type": "Microsoft.Compute/availabilitySets",
      "location": "[resourceGroup().location]",
      "apiVersion": "2015-06-15",
      "dependsOn": [],
      "tags": {
        "displayName": "asubuntu"
      },
      "properties": {
        "platformUpdateDomainCount": 3,
        "platformFaultDomainCount": 3
      }
    }
  ],
  "outputs": {
  }
}
